<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чати</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.6.16/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.6.16/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@6.0.2/dist/browser/signalr.min.js"></script>

</head>
<body>

    <div id="app">
        <div id="authWindow" class="uk-modal-full" uk-modal>
            <div class="uk-modal-dialog uk-flex uk-flex-center uk-flex-middle" style="height: 100%;">
                <div class="uk-modal-body">
                    <h2 class="uk-modal-title">Авторизація</h2>
                    <form @submit.prevent="authenticate">
                        <div class="uk-margin">
                            <input class="uk-input" v-model="username" type="text" placeholder="Логін" required>
                        </div>
                        <div class="uk-margin">
                            <input class="uk-input" v-model="password" type="password" placeholder="Пароль" required>
                        </div>
                        <button class="uk-button uk-button-primary" type="submit">Вхід</button>
                    </form>
                    <div v-if="authMessage" class="uk-margin-top uk-text-danger">{{ authMessage }}</div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="contacts">
                <div class="chat-contact-header">
                    <h4>Контакти</h4>
                </div>
                <ul>
                    <li v-for="contact in contacts" :key="contact.id" class="contact-item"
                        @click="selectContact(contact)"
                        :class="{ selected: selectedContact && selectedContact.id === contact.id }">
                        <img :src="contact.img_url" :alt="contact.name" width="40" height="40">
                        <div class="contact-info">
                            <span class="contact-name">{{ contact.name }}</span>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="chat-content">
                <div class="chat-header">
                    <h4>{{ selectedContact ? selectedContact.name : 'Оберіть контакт' }}</h4>
                </div>
                <div class="chat-messages" ref="chatMessages">
                    <div v-for="message in messages" :key="message.id" :class="['message-item', message.is_operator_message ? 'my-message' : 'other-message']">
                        <div class="message-content">
                            <span class="message-text">{{ message.value }}</span>
                            <span class="message-time">{{ formatDate(message.added_time) }}</span>
                        </div>
                    </div>
                </div>
                <div class="chat-footer">
                    <div v-if="!selectedContact" class="no-contact-message">Оберіть контакт для перегляду історії повідомлень</div>
                    <form v-if="selectedContact" @submit.prevent="sendMessage">
                        <input v-model="messageInput" type="text" placeholder="Напишіть ваше повідомлення..." />
                        <button class="uk-button uk-button-secondary" type="submit">➤</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>

</body>
</html>
